// 세종시 아파트 데이터 및 분류 시스템
// 데이터 기준: 2024년 7월

// 16개 실제 아파트 마을 (데이터 존재하는 마을만)
const VILLAGES = [
    '가락마을', '가온마을', '가재마을', '나릿재마을', '도램마을', 
    '범지기마을', '산울마을', '새나루마을', '새뜸마을', '새샘마을',
    '수루배마을', '첫마을', '한뜰마을', '해들마을', '해밀마을', 
    '호려울마을', '기타(도시형/오피스텔)'
];

// 10단계 균등 분포 가격 구간
const PRICE_RANGES = [
    { min: 0, max: 10450, name: "1억 미만" },
    { min: 10450, max: 13000, name: "1억대" },
    { min: 13000, max: 38730, name: "1억 후반-3억대" },
    { min: 38730, max: 46000, name: "3-4억대" },
    { min: 46000, max: 50000, name: "4-5억대" },
    { min: 50000, max: 60000, name: "5-6억대" },
    { min: 60000, max: 67300, name: "6-7억대" },
    { min: 67300, max: 73600, name: "7-8억대" },
    { min: 73600, max: 86400, name: "8-9억대" },
    { min: 86400, max: 200000, name: "9억 이상" }
];

// 마을 분류 함수
function classifyVillage(complexName) {
    const villageKeywords = {
        '가락': '가락마을',
        '가온': '가온마을', 
        '가재': '가재마을',
        '나릿재': '나릿재마을',
        '도램': '도램마을',
        '범지기': '범지기마을',
        '산울': '산울마을',
        '새나루': '새나루마을',
        '새뜸': '새뜸마을',
        '새샘': '새샘마을',
        '수루배': '수루배마을',
        '첫마을': '첫마을',
        '한뜰': '한뜰마을',
        '해들': '해들마을',
        '해밀': '해밀마을',
        '호려울': '호려울마을'
    };
    
    for (const [keyword, villageName] of Object.entries(villageKeywords)) {
        if (complexName.includes(keyword)) {
            return villageName;
        }
    }
    
    // 도담 패턴도 도램마을로 분류
    if (complexName.includes('도담')) {
        return '도램마을';
    }
        
    return '기타(도시형/오피스텔)';
}

// 가격 구간 분류 함수
function classifyPriceRange(price) {
    if (!price) return '정보없음';
    
    for (const range of PRICE_RANGES) {
        if (price >= range.min && price < range.max) {
            return range.name;
        }
    }
    
    return '9억 이상';
}

// 평형 분류 함수
function classifyAreaType(area) {
    if (!area) return '정보없음';
    
    const pyeong = area / 3.3;
    
    if (pyeong < 20) return '소형 (20평 미만)';
    if (pyeong < 30) return '중소형 (20-30평)';
    if (pyeong < 40) return '중형 (30-40평)';
    return '대형 (40평 이상)';
}

// 가격 표시 함수
function formatPrice(price) {
    if (!price) return '정보없음';
    
    if (price >= 10000) {
        return `${(price / 10000).toFixed(1)}억원`;
    } else {
        return `${price.toLocaleString()}만원`;
    }
}

// 면적 표시 함수 (㎡ + 평)
function formatArea(area) {
    if (!area) return '정보없음';
    
    const pyeong = (area / 3.3).toFixed(1);
    return `${area}㎡ (${pyeong}평)`;
}

// 준공년도 추출 함수
function extractYear(yearMonth) {
    if (!yearMonth || yearMonth.length < 4) return '정보없음';
    return yearMonth.substring(0, 4) + '년';
}

// 가격 배지 클래스 결정
function getPriceBadgeClass(price) {
    if (!price) return '';
    
    if (price >= 70000) return 'price-high';
    if (price >= 40000) return 'price-medium';
    return 'price-low';
}

// 데이터 로딩 함수 (실제 JSON 파일에서 로드)
async function loadApartmentData() {
    try {
        // 실제 환경에서는 JSON 파일에서 로드
        const response = await fetch('../data/sejong_classified.json');
        const rawData = await response.json();
        
        // 데이터 처리 및 분류
        const processedData = rawData.map(item => ({
            ...item,
            마을분류: classifyVillage(item.단지명),
            가격구간: classifyPriceRange(item['중간매매가(만원)']),
            평형구간: classifyAreaType(item['대표면적(㎡)']),
            표시가격: formatPrice(item['중간매매가(만원)']),
            표시면적: formatArea(item['대표면적(㎡)']),
            표시년도: extractYear(item.준공년월),
            가격배지: getPriceBadgeClass(item['중간매매가(만원)'])
        }));
        
        return processedData;
    } catch (error) {
        console.error('데이터 로딩 오류:', error);
        
        // 개발용 샘플 데이터 (실제 사용시 제거)
        return generateSampleData();
    }
}

// 개발용 확장 샘플 데이터 (16개 마을 모두 커버)
function generateSampleData() {
    const sampleData = [
        // 나릿재마을 (최고가)
        { "단지명": "나릿재6단지한신더휴리저브(주상복합)", "중간매매가(만원)": 120000, "대표면적(㎡)": 125, "준공년월": "202203", "총세대수": 400 },
        { "단지명": "나릿재2단지리더스포레(주상복합)", "중간매매가(만원)": 112000, "대표면적(㎡)": 120, "준공년월": "202101", "총세대수": 350 },
        { "단지명": "나릿재5단지한신더휴리저브(주상복합)", "중간매매가(만원)": 110000, "대표면적(㎡)": 130, "준공년월": "202105", "총세대수": 380 },
        
        // 한뜰마을
        { "단지명": "한뜰5단지린스트라우스(주상복합)", "중간매매가(만원)": 120000, "대표면적(㎡)": 130, "준공년월": "202105", "총세대수": 350 },
        { "단지명": "한뜰6단지세종중흥S-클래스센텀뷰(주상복합)", "중간매매가(만원)": 91000, "대표면적(㎡)": 115, "준공년월": "201912", "총세대수": 280 },
        { "단지명": "한뜰마을4단지한신더휴리저브II(주상복합)", "중간매매가(만원)": 85000, "대표면적(㎡)": 125, "준공년월": "202008", "총세대수": 320 },
        
        // 새뜸마을
        { "단지명": "새뜸9단지예미지", "중간매매가(만원)": 115000, "대표면적(㎡)": 110, "준공년월": "201905", "총세대수": 520 },
        { "단지명": "새뜸11단지더샵힐스테이트", "중간매매가(만원)": 115000, "대표면적(㎡)": 115, "준공년월": "202001", "총세대수": 480 },
        { "단지명": "새뜸14단지더샵힐스테이트", "중간매매가(만원)": 92000, "대표면적(㎡)": 105, "준공년월": "201908", "총세대수": 450 },
        { "단지명": "새뜸12단지예미지", "중간매매가(만원)": 62000, "대표면적(㎡)": 82, "준공년월": "201704", "총세대수": 472 },
        
        // 호려울마을
        { "단지명": "호려울4단지이지더원센트럴파크", "중간매매가(만원)": 95000, "대표면적(㎡)": 125, "준공년월": "201912", "총세대수": 600 },
        { "단지명": "호려울5단지풍경채퍼스트&파크", "중간매매가(만원)": 86000, "대표면적(㎡)": 120, "준공년월": "201808", "총세대수": 380 },
        { "단지명": "호려울10단지중흥S-클래스리버뷰2차", "중간매매가(만원)": 80000, "대표면적(㎡)": 110, "준공년월": "201905", "총세대수": 420 },
        { "단지명": "호려울7단지세종대방디엠시티(주상복합)", "중간매매가(만원)": 77000, "대표면적(㎡)": 116, "준공년월": "201909", "총세대수": 548 },
        
        // 가온마을
        { "단지명": "가온10단지더하이스트", "중간매매가(만원)": 82000, "대표면적(㎡)": 98, "준공년월": "201810", "총세대수": 320 },
        { "단지명": "가온4단지e편한세상푸르지오", "중간매매가(만원)": 80000, "대표면적(㎡)": 102, "준공년월": "201806", "총세대수": 380 },
        { "단지명": "가온5단지중흥S-클래스센텀시티", "중간매매가(만원)": 75000, "대표면적(㎡)": 113, "준공년월": "201801", "총세대수": 370 },
        { "단지명": "가온1단지힐스테이트세종2차", "중간매매가(만원)": 74000, "대표면적(㎡)": 132, "준공년월": "201803", "총세대수": 1631 },
        
        // 해들마을
        { "단지명": "해들6단지e편한세상세종리버파크", "중간매매가(만원)": 95000, "대표면적(㎡)": 125, "준공년월": "201912", "총세대수": 450 },
        { "단지명": "해들4단지중흥S클래스에듀퍼스트", "중간매매가(만원)": 75000, "대표면적(㎡)": 127, "준공년월": "201808", "총세대수": 1015 },
        { "단지명": "해들1단지신동아파밀리에3차", "중간매매가(만원)": 70000, "대표면적(㎡)": 115, "준공년월": "201702", "총세대수": 520 },
        
        // 도램마을
        { "단지명": "도램14단지한림풀에버", "중간매매가(만원)": 95000, "대표면적(㎡)": 120, "준공년월": "201908", "총세대수": 380 },
        { "단지명": "도램9단지풍경채센트럴", "중간매매가(만원)": 90000, "대표면적(㎡)": 115, "준공년월": "201805", "총세대수": 420 },
        { "단지명": "도램10단지호반베르디움어반시티", "중간매매가(만원)": 75000, "대표면적(㎡)": 110, "준공년월": "201812", "총세대수": 380 },
        { "단지명": "도램2단지웅진스타클래스2차", "중간매매가(만원)": 48000, "대표면적(㎡)": 85, "준공년월": "201405", "총세대수": 300 },
        
        // 새샘마을
        { "단지명": "새샘7단지힐스테이트세종리버파크(주상복합)", "중간매매가(만원)": 100000, "대표면적(㎡)": 140, "준공년월": "202006", "총세대수": 450 },
        { "단지명": "새샘8단지힐스테이트세종리버파크(주상복합)", "중간매매가(만원)": 90000, "대표면적(㎡)": 135, "준공년월": "202008", "총세대수": 420 },
        { "단지명": "새샘3단지모아미래도리버시티", "중간매매가(만원)": 85000, "대표면적(㎡)": 125, "준공년월": "201810", "총세대수": 380 },
        { "단지명": "새샘1단지중흥S-클래스에듀마크", "중간매매가(만원)": 70000, "대표면적(㎡)": 110, "준공년월": "201808", "총세대수": 890 },
        
        // 해밀마을
        { "단지명": "해밀2단지마스터힐스", "중간매매가(만원)": 69000, "대표면적(㎡)": 105, "준공년월": "201905", "총세대수": 280 },
        { "단지명": "해밀1단지마스터힐스", "중간매매가(만원)": 51000, "대표면적(㎡)": 98, "준공년월": "201812", "총세대수": 320 },
        
        // 수루배마을
        { "단지명": "수루배3단지리슈빌더리버", "중간매매가(만원)": 96000, "대표면적(㎡)": 130, "준공년월": "201908", "총세대수": 380 },
        { "단지명": "수루배1단지캐슬&파밀리에디아트", "중간매매가(만원)": 72000, "대표면적(㎡)": 115, "준공년월": "201805", "총세대수": 420 },
        { "단지명": "수루배6단지세종더샵예미지(L4블록)", "중간매매가(만원)": 51000, "대표면적(㎡)": 98, "준공년월": "201912", "총세대수": 350 },
        
        // 범지기마을
        { "단지명": "범지기1단지한양수자인에듀센텀", "중간매매가(만원)": 69000, "대표면적(㎡)": 115, "준공년월": "201605", "총세대수": 520 },
        { "단지명": "범지기3단지세종중흥S클래스에듀하이", "중간매매가(만원)": 63000, "대표면적(㎡)": 110, "준공년월": "201508", "총세대수": 480 },
        { "단지명": "범지기9단지세종한신휴플러스엘리트파크", "중간매매가(만원)": 60000, "대표면적(㎡)": 127, "준공년월": "201503", "총세대수": 687 },
        
        // 첫마을
        { "단지명": "첫마을7단지래미안", "중간매매가(만원)": 80000, "대표면적(㎡)": 125, "준공년월": "201905", "총세대수": 450 },
        { "단지명": "첫마을3단지퍼스트프라임", "중간매매가(만원)": 69000, "대표면적(㎡)": 115, "준공년월": "201808", "총세대수": 380 },
        { "단지명": "첫마을1단지퍼스트프라임", "중간매매가(만원)": 65000, "대표면적(㎡)": 110, "준공년월": "201805", "총세대수": 420 },
        
        // 가재마을
        { "단지명": "가재3단지중흥S-클래스에듀타운", "중간매매가(만원)": 68000, "대표면적(㎡)": 115, "준공년월": "201512", "총세대수": 480 },
        { "단지명": "가재마을7단지중흥S-클래스센텀파크1차", "중간매매가(만원)": 65000, "대표면적(㎡)": 110, "준공년월": "201608", "총세대수": 420 },
        { "단지명": "가재12단지중흥S-클래스센텀파크2차", "중간매매가(만원)": 65000, "대표면적(㎡)": 112, "준공년월": "201610", "총세대수": 380 },
        { "단지명": "가재6단지세경", "중간매매가(만원)": 40000, "대표면적(㎡)": 103, "준공년월": "201610", "총세대수": 310 },
        
        // 산울마을
        { "단지명": "산울2단지세종자이더시티", "중간매매가(만원)": 100000, "대표면적(㎡)": 135, "준공년월": "202008", "총세대수": 450 },
        { "단지명": "산울7단지세종리첸시아파밀리에H2블록(주상복합)", "중간매매가(만원)": 85000, "대표면적(㎡)": 125, "준공년월": "201912", "총세대수": 380 },
        { "단지명": "산울8단지엘리프세종6-3", "중간매매가(만원)": 63000, "대표면적(㎡)": 105, "준공년월": "201908", "총세대수": 320 },
        { "단지명": "산울5단지세종파밀리에더파크", "중간매매가(만원)": 120000, "대표면적(㎡)": 145, "준공년월": "202105", "총세대수": 420 },
        
        // 가락마을
        { "단지명": "가락1단지세종힐데스하임", "중간매매가(만원)": 73000, "대표면적(㎡)": 132, "준공년월": "201811", "총세대수": 555 },
        { "단지명": "가락마을2단지", "중간매매가(만원)": 69000, "대표면적(㎡)": 125, "준공년월": "201805", "총세대수": 480 },
        { "단지명": "가락18단지힐스테이트", "중간매매가(만원)": 65000, "대표면적(㎡)": 120, "준공년월": "201710", "총세대수": 420 },
        { "단지명": "가락13단지대광로제비앙", "중간매매가(만원)": 45000, "대표면적(㎡)": 112, "준공년월": "201511", "총세대수": 490 },
        { "단지명": "가락8단지고운뜰파크", "중간매매가(만원)": 41000, "대표면적(㎡)": 98, "준공년월": "201508", "총세대수": 380 },
        
        // 새나루마을
        { "단지명": "새나루1단지자이e편한세상", "중간매매가(만원)": 63000, "대표면적(㎡)": 115, "준공년월": "201808", "총세대수": 480 },
        { "단지명": "세종하늘채센트레빌(새나루마을8단지)", "중간매매가(만원)": 60000, "대표면적(㎡)": 109, "준공년월": "202203", "총세대수": 499 },
        { "단지명": "세종더휴예미지(새나루마을3단지)", "중간매매가(만원)": 59000, "대표면적(㎡)": 109, "준공년월": "202111", "총세대수": 508 },
        { "단지명": "새나루마을5단지", "중간매매가(만원)": 42000, "대표면적(㎡)": 98, "준공년월": "201905", "총세대수": 380 },
        
        // 기타(도시형/오피스텔)
        { "단지명": "세종펠리스(도시형)", "중간매매가(만원)": 17500, "대표면적(㎡)": 46, "준공년월": "202002", "총세대수": 170 },
        { "단지명": "아크레타아이콤스타시티(도시형)", "중간매매가(만원)": 11750, "대표면적(㎡)": 36, "준공년월": "201805", "총세대수": 37 },
        { "단지명": "펜트빌(도시형)", "중간매매가(만원)": 48700, "대표면적(㎡)": 83, "준공년월": "202305", "총세대수": 56 },
        { "단지명": "퍼스트시티(도시형)", "중간매매가(만원)": 11000, "대표면적(㎡)": 33, "준공년월": "201610", "총세대수": 27 },
        { "단지명": "SR파크(도시형)", "중간매매가(만원)": 13000, "대표면적(㎡)": 51, "준공년월": "201410", "총세대수": 140 },
        { "단지명": "블루지움(도시형)", "중간매매가(만원)": 10000, "대표면적(㎡)": 45, "준공년월": "201504", "총세대수": 150 },
        { "단지명": "씨즈파크뷰(도시형)", "중간매매가(만원)": 13000, "대표면적(㎡)": 34, "준공년월": "201902", "총세대수": 128 },
        { "단지명": "라온프라이빗시티Ⅰ(도시형)", "중간매매가(만원)": 8000, "대표면적(㎡)": 37, "준공년월": "201411", "총세대수": 290 },
        { "단지명": "세종모닝시티2차(도시형)", "중간매매가(만원)": 9800, "대표면적(㎡)": 36, "준공년월": "201602", "총세대수": 216 },
        { "단지명": "더리치세종의아침(도시형)", "중간매매가(만원)": 10000, "대표면적(㎡)": 31, "준공년월": "201510", "총세대수": 156 }
    ];
    
    return sampleData.map(item => ({
        ...item,
        마을분류: classifyVillage(item.단지명),
        가격구간: classifyPriceRange(item['중간매매가(만원)']),
        평형구간: classifyAreaType(item['대표면적(㎡)']),
        표시가격: formatPrice(item['중간매매가(만원)']),
        표시면적: formatArea(item['대표면적(㎡)']),
        표시년도: extractYear(item.준공년월),
        가격배지: getPriceBadgeClass(item['중간매매가(만원)'])
    }));
}

// 전역 데이터 저장
window.apartmentData = [];
window.filteredData = [];

// 데이터 초기화
async function initializeData() {
    window.apartmentData = await loadApartmentData();
    window.filteredData = [...window.apartmentData];
    console.log('데이터 로딩 완료:', window.apartmentData.length, '개 단지');
}